# litgen template

An adaptation of [scikit_build_example](https://github.com/pybind/scikit_build_example) for [litgen](https://github.com/pthom/litgen)

## Usage for final users

__First, install the package__
```bash
git clone https://github.com/pthom/litgen_template.git && cd litgen_template
pip install -v .
```

__Then, try to import and use it from python__
```python
import lg_examplelib
lg_examplelib.add(1, 2)
```


## Usage in editable development mode

```bash
# Install the package in editable mode
pip install -v -e .
# Build the package so that it is used in editable mode
mkdir build && cd build 
cmake ..
make
```

----------------

## How-to modify and regenerate the bindings

### Step 1: create a virtual environment and install requirements

This will create a virtual environment and install the requirements for development: litgen, pybind11, pytest, black, mypy.

```bash
python3 -m venv venv
source venv/bin/activate
pip install -r requirements-dev.txt
```

### Step 2: install srcML (required by litgen)

Follow the [instructions on the litgen website](https://pthom.github.io/litgen/litgen_book/01_05_10_install.html) 

### Step 3: autogenerate the binding code

Optional: 
- Change the C++ code (add functions, etc) in `external/examplelibcpp/include/examplelibcpp.h`
- Adapt the generation options inside `autogenerate_lg_examplelib.py`

__Run the code generation via litgen__
```
python autogenerate_lg_examplelib.py
```

This will:
* Write the cpp binding code into `bindings/pybind_mylib.cpp`
* Write the python stub code into `bindings/lg_examplelib/__init__.pyi`


----------------

## Folder structure

### Folder structure

Below is a summary of the folder structure:

```
./
├── pyproject.toml                        # Pip configuration file
├── setup.py                              # Pip configuration file
├── CMakeLists.txt                        # CMakeLists (used also by pip, via skbuild)
├── requirements-dev.txt                  # Requirements for development (litgen, pybind11, pytest, black, mypy)
├── Readme.md                             # This file
├── _skbuild/                             # Temp build directory when building via pip
│
├── autogenerate_lg_examplelib.py         # This script will read headers in 
│                                         # external/examplelibcpp/include and
│                                         # generate bindings using litgen inside:
│                                         #    - bindings/pybind_examplelibcpp.cpp (C++ publishing code)
│                                         #    - bindings/lg_examplelib/__init__.pyi (stubs)
│
├── bindings/                             # root of the generated bindings
│         ├── lg_examplelib/
│         │         ├── __init__.py       # The python module main entry point
│         │         ├── __init__.pyi      # Stubs generated by litgen
│         │         └── py.typed          # An empty file that indicates that the python module is typed
│         ├── module.cpp                  # Main entry point of the python module
│         └── pybind_examplelibcpp.cpp    # File with bindings generated by litgen
│
├── litgen_cmake/                         # litgen_setup_module() is a cmake function that simplifies
│         └── litgen_setup_module.cmake   # the deployment of a python module with litgen
│         
├── external/
│         ├──examplelibcpp/                   # C++ library that will be wrapped in a python module
│                ├── CMakeLists.txt
│                ├── examplelibcpp.cpp
│                ├── examplelibcpp.h
│                ├── ...
│                
├── tests/lg_examplelib_test.py    # This is a list of python tests that will check
└── pytest.ini
```
